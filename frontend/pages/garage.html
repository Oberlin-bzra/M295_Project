<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" type="text/css" href="/styles/styles.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script type="module" src="/src/darkmode.ts"></script>
  <script type="module" src="/src/auth-nav.ts"></script>
  <link rel="icon" type="image/x-icon" href="/faviconNew.jpg" />
  <title>ApexTracker - Garage</title>
</head>
<body>
<header>
  <a href="/index.html" class="logo-link"><h1>ApexTracker</h1></a>
  <div class="nav-buttons">
    <a href="/pages/login.html" class="btn btn-primary">Login</a>
    <a href="/pages/dashboard.html" class="btn btn-secondary">Dashboard</a>
    <a href="/pages/garage.html" class="btn btn-secondary">Garage</a>
    <button id="darkmode-btn"><span>üåô</span></button>
  </div>
</header>

<main class="dashboard-content">
  <h1>Meine Favoriten</h1>

  <section>
    <h2>Favorisierte Teams</h2>
    <table id="fav-teams-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Country</th>
          <th>Drivers</th>
          <th>Team Principal</th>
          <th>Championships</th>
          <th>Points</th>
          <th>Place</th>
          <th class="star-header">‚≠ê</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Favorisierte Fahrer</h2>
    <table id="fav-drivers-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Nationality</th>
          <th>Age</th>
          <th>Championships</th>
          <th>Team</th>
          <th>Wins</th>
          <th>Podiums</th>
          <th>Points</th>
          <th>Place</th>
          <th class="star-header">‚≠ê</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Favorisierte Fahrzeuge</h2>
    <table id="fav-vehicles-table">
      <thead>
        <tr>
          <th>Model</th>
          <th>Engine</th>
          <th>Team</th>
          <th>Drivers</th>
          <th>Horsepower</th>
          <th>Year</th>
          <th class="star-header">‚≠ê</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<footer>
  <small>&copy; 2025 ApexTracker</small> |
  <small><a href="./impressum.html">Impressum</a></small>
</footer>

<script>
if(!localStorage.getItem('teamsData')) {
  const teams = [
    { name: "Red Bull Racing Honda RBPT", country: "Austria", drivers: ["Max Verstappen","Sergio P√©rez"], teamPrincipal: "Christian Horner", championships: 6, constructorPoints: 589, constructorPlace: 3 },
    { name: "Mercedes", country: "United Kingdom", drivers: ["Lewis Hamilton","George Russell"], teamPrincipal: "Toto Wolff", championships: 8, constructorPoints: 468, constructorPlace: 4 },
    { name: "Ferrari", country: "Italy", drivers: ["Charles Leclerc","Carlos Sainz"], teamPrincipal: "Fr√©d√©ric Vasseur", championships: 16, constructorPoints: 652, constructorPlace: 2 },
    { name: "McLaren Mercedes", country: "United Kingdom", drivers: ["Lando Norris","Oscar Piastri"], teamPrincipal: "Andrea Stella", championships: 9, constructorPoints: 666, constructorPlace: 1 },
    { name: "Aston Martin Aramco Mercedes", country: "United Kingdom", drivers: ["Fernando Alonso","Lance Stroll"], teamPrincipal: "Mike Krack", championships: 0, constructorPoints: 94, constructorPlace: 5 },
    { name: "Alpine Renault", country: "France", drivers: ["Esteban Ocon","Pierre Gasly"], teamPrincipal: "Oliver Oakes", championships: 2, constructorPoints: 65, constructorPlace: 6 },
    { name: "Williams Mercedes", country: "United Kingdom", drivers: ["Alex Albon","Logan Sargeant"], teamPrincipal: "James Vowles", championships: 0, constructorPoints: 17, constructorPlace: 9 },
    { name: "Haas Ferrari", country: "United States", drivers: ["Nico H√ºlkenberg","Kevin Magnussen"], teamPrincipal: "Ayao Komatsu", championships: 0, constructorPoints: 58, constructorPlace: 7 },
    { name: "Kick Sauber Ferrari", country: "Switzerland", drivers: ["Valtteri Bottas","Zhou Guanyu"], teamPrincipal: "Bruno Famin", championships: 0, constructorPoints: 4, constructorPlace: 10 },
    { name: "RB Honda RBPT", country: "Italy", drivers: ["Yuki Tsunoda","Daniel Ricciardo"], teamPrincipal: "Laurent Mekies", championships: 0, constructorPoints: 46, constructorPlace: 8 }
  ];
  localStorage.setItem('teamsData', JSON.stringify(teams));
}

if(!localStorage.getItem('driversData')) {
  const drivers = [
    { name: "Max Verstappen", nationality: "Netherlands", age: 27, championships: 4, team: "Red Bull Racing Honda RBPT", wins: 9, podiums: 14, points: 437, place: 1 },
    { name: "Sergio P√©rez", nationality: "Mexico", age: 34, championships: 0, team: "Red Bull Racing Honda RBPT", wins: 0, podiums: 4, points: 152, place: 8 },
    { name: "Lewis Hamilton", nationality: "United Kingdom", age: 39, championships: 7, team: "Mercedes", wins: 2, podiums: 5, points: 223, place: 7 },
    { name: "George Russell", nationality: "United Kingdom", age: 26, championships: 0, team: "Mercedes", wins: 2, podiums: 4, points: 245, place: 6 },
    { name: "Charles Leclerc", nationality: "Monaco", age: 27, championships: 0, team: "Ferrari", wins: 3, podiums: 13, points: 356, place: 3 },
    { name: "Carlos Sainz", nationality: "Spain", age: 30, championships: 0, team: "Ferrari", wins: 2, podiums: 9, points: 290, place: 5 },
    { name: "Lando Norris", nationality: "United Kingdom", age: 25, championships: 0, team: "McLaren Mercedes", wins: 4, podiums: 13, points: 374, place: 2 },
    { name: "Oscar Piastri", nationality: "Australia", age: 23, championships: 0, team: "McLaren Mercedes", wins: 2, podiums: 0, points: 292, place: 4 },
    { name: "Fernando Alonso", nationality: "Spain", age: 43, championships: 2, team: "Aston Martin Aramco Mercedes", wins: 0, podiums: 0, points: 70, place: 9 },
    { name: "Lance Stroll", nationality: "Canada", age: 26, championships: 0, team: "Aston Martin Aramco Mercedes", wins: 0, podiums: 0, points: 24, place: 13 }
  ];
  localStorage.setItem('driversData', JSON.stringify(drivers));
}

if(!localStorage.getItem('vehiclesData')) {
  const vehicles = [
    { model: "RB20", engine: "Honda RBPT", team: "Red Bull Racing Honda RBPT", drivers: ["Max Verstappen","Sergio P√©rez"], horsepower: 1050, year: 2024 },
    { model: "W15", engine: "Mercedes", team: "Mercedes", drivers: ["Lewis Hamilton","George Russell"], horsepower: 1030, year: 2024 },
    { model: "SF-24", engine: "Ferrari", team: "Ferrari", drivers: ["Charles Leclerc","Carlos Sainz"], horsepower: 1040, year: 2024 },
    { model: "MCL38", engine: "Mercedes", team: "McLaren Mercedes", drivers: ["Lando Norris","Oscar Piastri"], horsepower: 1020, year: 2024 },
    { model: "AMR24", engine: "Mercedes", team: "Aston Martin Aramco Mercedes", drivers: ["Fernando Alonso","Lance Stroll"], horsepower: 1025, year: 2024 }
  ];
  localStorage.setItem('vehiclesData', JSON.stringify(vehicles));
}

const teams = JSON.parse(localStorage.getItem('teamsData') || '[]');
const drivers = JSON.parse(localStorage.getItem('driversData') || '[]');
const vehicles = JSON.parse(localStorage.getItem('vehiclesData') || '[]');

let savedTeams = JSON.parse(localStorage.getItem('favTeams') || '[]');
let savedDrivers = JSON.parse(localStorage.getItem('favDrivers') || '[]');
let savedVehicles = JSON.parse(localStorage.getItem('favVehicles') || '[]');

function persistFavs() {
  localStorage.setItem('favTeams', JSON.stringify(savedTeams));
  localStorage.setItem('favDrivers', JSON.stringify(savedDrivers));
  localStorage.setItem('favVehicles', JSON.stringify(savedVehicles));
}

function idForItem(item) {
  return item.name || item.model;
}

function isSaved(tableId, id) {
  if (tableId.includes("teams")) return savedTeams.includes(id);
  if (tableId.includes("drivers")) return savedDrivers.includes(id);
  return savedVehicles.includes(id);
}

function toggleLocalFavorite(tableId, id, btn) {
  let list;
  if (tableId.includes("teams")) list = savedTeams;
  else if (tableId.includes("drivers")) list = savedDrivers;
  else list = savedVehicles;

  const idx = list.indexOf(id);
  if (idx === -1) {
    list.push(id);
    btn.textContent = "‚òÖ";
    btn.classList.add("active");
  } else {
    list.splice(idx, 1);
    btn.textContent = "‚òÜ";
    btn.classList.remove("active");
  }

  persistFavs();
  renderAll(); 
}

function renderTable(array, tableId, keys) {
  const tbody = document.querySelector(`#${tableId} tbody`);
  tbody.innerHTML = "";

  array.forEach(item => {
    const id = idForItem(item);
    if (!isSaved(tableId, id)) return; 

    const tr = document.createElement("tr");

    keys.forEach(key => {
      const td = document.createElement("td");
      let value = item[key];
      if (Array.isArray(value)) value = value.join(", ");
      td.textContent = value ?? "";
      tr.appendChild(td);
    });

    const favTd = document.createElement("td");
    const favBtn = document.createElement("button");
    favBtn.className = "star-btn active";
    favBtn.textContent = "‚òÖ";
    favBtn.addEventListener("click", e => {
      e.stopPropagation();
      toggleLocalFavorite(tableId, id, favBtn);
    });

    favTd.appendChild(favBtn);
    tr.appendChild(favTd);
    tbody.appendChild(tr);
  });
}

function renderAll() {
  renderTable(teams, "fav-teams-table", ["name","country","drivers","teamPrincipal","championships","constructorPoints","constructorPlace"]);
  renderTable(drivers, "fav-drivers-table", ["name","nationality","age","championships","team","wins","podiums","points","place"]);
  renderTable(vehicles, "fav-vehicles-table", ["model","engine","team","drivers","horsepower","year"]);
}

function makeTableSortable(tableId) {
  const table = document.getElementById(tableId);
  const headers = table.querySelectorAll("th");
  const tbody = table.querySelector("tbody");

  headers.forEach((header, index) => {
    if(header.classList.contains("star-header")) return; 
    header.style.cursor = "pointer";
    header.innerHTML += ' <span class="sort-arrow">‚Üï</span>';

    header.addEventListener("click", () => {
      const rows = Array.from(tbody.querySelectorAll("tr"));
      const ascending = header.dataset.asc !== "true";
      header.dataset.asc = ascending;

      headers.forEach(h => {
        const arrow = h.querySelector(".sort-arrow");
        if (arrow) arrow.textContent = "‚Üï";
      });

      const arrow = header.querySelector(".sort-arrow");
      arrow.textContent = ascending ? "‚ñ≤" : "‚ñº";

      rows.sort((a, b) => {
        let valA = a.children[index].textContent.trim();
        let valB = b.children[index].textContent.trim();

        const isNumeric = !isNaN(valA) && !isNaN(valB);
        if(isNumeric) { valA = parseFloat(valA); valB = parseFloat(valB); }

        if(valA < valB) return ascending ? -1 : 1;
        if(valA > valB) return ascending ? 1 : -1;
        return 0;
      });

      rows.forEach(r => tbody.appendChild(r));
    });
  });
}

renderAll();
["fav-teams-table","fav-drivers-table","fav-vehicles-table"].forEach(makeTableSortable);
</script>
</body>
</html>
